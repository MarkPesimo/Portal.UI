@model APWModel.ViewModel.Portal.DTR_model.DTRmodel.DTRPostDetailResult


@using (Html.BeginForm("_AddCorrection", "Attendance", FormMethod.Post, new { enctype = "multipart/form-data", name = "post-dtr-Form", id = "post-dtr-Form" }))
{
    @Html.HiddenFor(m => m.DTR.Id, new { Name = "Id" })
    @Html.HiddenFor(m => m.DTR.UserId, new { Name = "UserId" })
    @Html.HiddenFor(m => m.DTR.EmpId, new { Name = "EmpId" })
    @Html.HiddenFor(m => m.DTR.Description, new { Name = "Description" })
    @Html.HiddenFor(m => m.DTR.DateFrom, new { Name = "DateFrom" })
    @Html.HiddenFor(m => m.DTR.Dateto, new { Name = "Dateto" })
    @Html.HiddenFor(m => m.DTR.Remarks, new { Name = "Remarks" })
    @Html.HiddenFor(m => m.DTR.Mode, new { Name = "Mode" })

    <div class="row" id="div-validation" style="display: none;">
        <div class="col mb-3">
            <label for="html" id="error-message-label" class="form-label text-danger"></label><br>
        </div>
    </div>
}


@Html.Partial("~/Views/Shared/_dtr_instruction.cshtml")

 

<div class="mb-3">
    <h6 class="fw-bold mb-1 text-muted small">SELECTED PERIOD:</h6>
    <h5 class="fw-bold">
        @Model.DTR.DateFrom.ToString("MMMM dd, yyyy") - @Model.DTR.Dateto.ToString("MMMM dd, yyyy")
    </h5>
</div>

<div class="card shadow-sm mb-4 border-0">
    <div class="card-header bg-white py-3">
        <h6 class="fw-bold mb-0 text-dark"><i class="bi bi-calendar-check me-2"></i>Attendance Logs</h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-sm table-striped table-hover align-middle mb-0">
                <thead>
                    <tr class="text-center">
                        <th>Date Log</th>
                        <th>Schedule</th>
                        <th>Time In</th>
                        <th>Time Out</th>
                        <th>Correction</th>
                        <th>Status</th>
                        <th>Log Entry</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Attendance != null && Model.Attendance.Any())
                    {
                        foreach (var a in Model.Attendance)
                        {
                            string _status_color = "#959A97";
                            string _text_color = "white";

                            if (a.Status == "Posted") { _status_color = "#ffc107"; _text_color = "black"; }
                            else if (a.Status == "Approved") { _status_color = "#198754"; }

                            <tr class="text-center">
                                <td>@a.DateLog</td>
                                <td style="color: @a.LateColor" class="@(a.WorkSchedule == "Absent" ? "text-danger fw-bold" : "")"> @a.WorkSchedule </td>
                                <td style="color: @a.LateColor">@a.TimeIn</td>
                                <td style="color: @a.UndertimeColor">@a.TimeOut</td>
                                <td>@a.HasCorrection</td>
                                <td>
                                    <span class="badge rounded-pill px-3" style="background:@_status_color; color: @_text_color">@a.Status</span>
                                </td>
                                <td>
                                    @a.AttendanceLogType
                            </td>

                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card shadow-sm mb-4 border-0">
    <div class="card-header bg-white py-3">
        <h6 class="fw-bold mb-0 text-dark"><i class="bi bi-clock-history me-2"></i>Overtime Details</h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            @{ decimal _total_othour = 0; }
            <table class="table table-sm table-striped table-hover align-middle mb-0 uniform-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Start</th>
                        <th>End</th>
                        <th>Hours</th>
                        <th class="reason-col">Reason</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Overtime != null && Model.Overtime.Any())
                    {
                        foreach (var ot in Model.Overtime)
                        {
                            _total_othour += ot.TotalHours;
                            string _status_color = "#959A97";
                            string _text_color = "white";

                            if (ot.Status == "Posted") { _status_color = "#ffc107"; _text_color = "black"; }
                            else if (ot.Status == "Approved") { _status_color = "#198754"; }

                            <tr>
                                <td>@ot.Date</td>
                                <td>@ot.Start</td>
                                <td>@ot.End</td>
                                <td class="fw-bold">@ot.TotalHours</td>
                                <td class="reason-col small text-muted">@ot.Reason</td>
                                <td><span class="badge rounded-pill px-3" style="background:@_status_color; color: @_text_color">@ot.Status</span></td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer bg-light border-0 py-2 text-end">
        <span class="text-muted small me-2">Total OT Hours:</span> <span class="fw-bold text-dark">@_total_othour</span>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-header bg-white py-3">
        <h6 class="fw-bold mb-0 text-dark"><i class="bi bi-calendar-event me-2"></i>Leave Summary</h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            @{ decimal _total_leavedays = 0; }
            <table class="table table-sm table-striped table-hover align-middle mb-0 uniform-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Days</th>
                        <th class="reason-col">Reason</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Leave != null && Model.Leave.Any())
                    {
                        foreach (var l in Model.Leave)
                        {
                            _total_leavedays += l.NoOfDays;
                            string _status_color = "#959A97";
                            string _text_color = "white";

                            if (l.Status == "Posted") { _status_color = "#ffc107"; _text_color = "black"; }
                            else if (l.Status == "Approved") { _status_color = "#198754"; }

                            <tr>
                                <td>@l.Date</td>
                                <td>@l.LeaveFrom</td>
                                <td>@l.LeaveTo</td>
                                <td class="fw-bold">@l.NoOfDays</td>
                                <td class="reason-col small text-muted">@l.Reason</td>
                                <td><span class="badge rounded-pill px-3" style="background:@_status_color; color: @_text_color">@l.Status</span></td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer bg-light border-0 py-2 text-end">
        <span class="text-muted small me-2">Total Leave Days:</span> <span class="fw-bold text-dark">@_total_leavedays</span>
    </div>
</div>